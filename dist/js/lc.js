"use strict";!function(){function a(a,b){return[a[0]*b[0]+a[1]*b[3],a[0]*b[1]+a[1]*b[4],a[0]*b[2]+a[1]*b[5]+a[2],a[3]*b[0]+a[4]*b[3],a[3]*b[1]+a[4]*b[4],a[3]*b[2]+a[4]*b[5]+a[5]]}function b(a,b){return[a[0]*b[0]+a[1]*b[1]+a[2],a[3]*b[0]+a[4]*b[1]+a[5]]}function c(a){return[1,0,a[0],0,1,a[1]]}function d(a){var b=Math.cos(a),c=Math.sin(a);return[b,c,0,-c,b,0]}function e(a){this.width=a.naturalWidth,this.height=a.naturalHeight,this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_LINEAR),r.generateMipmap(r.TEXTURE_2D),r.bindTexture(r.TEXTURE_2D,null)}function f(a,b){this.texture=a,this.frame={x:b.x/a.width,y:b.y/a.height,width:b.width/a.width,height:b.height/a.height},this.aspect=b.width/b.height}function g(a){return new Promise(function(b,c){var d=new Promise(function(b,c){var d=new Image;d.onload=function(){var a=new e(d);m.push(a),b(a)},d.onerror=c,d.src=a+".png"}),g=fetch(a+".json").then(function(a){return a.json()});Promise.all([d,g]).then(function(a){var c=a[0],d=a[1];for(var e in d)n[e]=new f(c,d[e]);b()})["catch"](c)})}function h(a){var b={alpha:!1,depth:!1,stencil:!1,preserveDrawingBuffer:!1};return a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}function i(a,b){var c=r.createShader(b);return r.shaderSource(c,a),r.compileShader(c),r.getShaderParameter(c,r.COMPILE_STATUS)||console.error(r.getShaderInfoLog(c)),c}function j(a,b){var c=r.createProgram();return r.attachShader(c,a),r.attachShader(c,b),r.linkProgram(c),r.getProgramParameter(c,r.LINK_STATUS)||console.error(r.getProgramInfoLog(c)),c}function k(){this.VERTEX_SIZE=8,this.BATCH_SIZE=128,this.batchIndex=0,this.vertexData=new Float32Array(this.BATCH_SIZE*this.VERTEX_SIZE*4),this.vertexBuffer=r.createBuffer(),this.indexBuffer=r.createBuffer();var a=i(o,r.VERTEX_SHADER),b=i(p,r.FRAGMENT_SHADER);this.program=j(a,b),this.aPosition=r.getAttribLocation(this.program,"a_position"),this.aTexCoord=r.getAttribLocation(this.program,"a_texCoord"),this.aColor=r.getAttribLocation(this.program,"a_color"),this.uTransform=r.getUniformLocation(this.program,"u_transform"),this.uTexture=r.getUniformLocation(this.program,"u_texture"),this.transform=new Float32Array([1,0,0,0,0,-(q.width/q.height),0,0,0,0,1,0,0,0,0,1]);for(var c=new Uint16Array(6*this.BATCH_SIZE),d=0,e=0;e<this.BATCH_SIZE;e+=6)c[e+0]=d+0,c[e+1]=d+1,c[e+2]=d+2,c[e+3]=d+2,c[e+4]=d+1,c[e+5]=d+3,d+=4;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,c,r.STATIC_DRAW),this.texture=null}function l(){r.clearColor(100/255,149/255,237/255,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),t+=.016;var b=.1*Math.sin(t),e=a(d(.2*Math.sin(2*t)),c([0,b])),f=n.lbase;s.draw(f,a(e,[f.aspect,0,0,0,1,0]));var g=n.lrotor;s.draw(g,a(e,[.5*Math.sin(8*t),0,-.03,0,1/g.aspect*.5,-.43])),s.flush(),window.requestAnimationFrame(l)}!function(){function a(a){if("string"!=typeof a&&(a=String(a)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function b(a){return"string"!=typeof a&&(a=String(a)),a}function c(a){this.map={},a instanceof c?a.forEach(function(a,b){this.append(b,a)},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}function d(a){return a.bodyUsed?Promise.reject(new TypeError("Already read")):void(a.bodyUsed=!0)}function e(a){return new Promise(function(b,c){a.onload=function(){b(a.result)},a.onerror=function(){c(a.error)}})}function f(a){var b=new FileReader;return b.readAsArrayBuffer(a),e(b)}function g(a){var b=new FileReader;return b.readAsText(a),e(b)}function h(){return this.bodyUsed=!1,this._initBody=function(a){if(this._bodyInit=a,"string"==typeof a)this._bodyText=a;else if(n.blob&&Blob.prototype.isPrototypeOf(a))this._bodyBlob=a;else if(n.formData&&FormData.prototype.isPrototypeOf(a))this._bodyFormData=a;else if(a){if(!n.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(a))throw new Error("unsupported BodyInit type")}else this._bodyText=""},n.blob?(this.blob=function(){var a=d(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(f)},this.text=function(){var a=d(this);if(a)return a;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var a=d(this);return a?a:Promise.resolve(this._bodyText)},n.formData&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}function i(a){var b=a.toUpperCase();return o.indexOf(b)>-1?b:a}function j(a,b){b=b||{};var d=b.body;if(j.prototype.isPrototypeOf(a)){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,b.headers||(this.headers=new c(a.headers)),this.method=a.method,this.mode=a.mode,d||(d=a._bodyInit,a.bodyUsed=!0)}else this.url=a;if(this.credentials=b.credentials||this.credentials||"omit",(b.headers||!this.headers)&&(this.headers=new c(b.headers)),this.method=i(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&d)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(d)}function k(a){var b=new FormData;return a.trim().split("&").forEach(function(a){if(a){var c=a.split("="),d=c.shift().replace(/\+/g," "),e=c.join("=").replace(/\+/g," ");b.append(decodeURIComponent(d),decodeURIComponent(e))}}),b}function l(a){var b=new c,d=a.getAllResponseHeaders().trim().split("\n");return d.forEach(function(a){var c=a.trim().split(":"),d=c.shift().trim(),e=c.join(":").trim();b.append(d,e)}),b}function m(a,b){b||(b={}),this._initBody(a),this.type="default",this.status=b.status,this.ok=this.status>=200&&this.status<300,this.statusText=b.statusText,this.headers=b.headers instanceof c?b.headers:new c(b.headers),this.url=b.url||""}if(!self.fetch){c.prototype.append=function(c,d){c=a(c),d=b(d);var e=this.map[c];e||(e=[],this.map[c]=e),e.push(d)},c.prototype["delete"]=function(b){delete this.map[a(b)]},c.prototype.get=function(b){var c=this.map[a(b)];return c?c[0]:null},c.prototype.getAll=function(b){return this.map[a(b)]||[]},c.prototype.has=function(b){return this.map.hasOwnProperty(a(b))},c.prototype.set=function(c,d){this.map[a(c)]=[b(d)]},c.prototype.forEach=function(a,b){Object.getOwnPropertyNames(this.map).forEach(function(c){this.map[c].forEach(function(d){a.call(b,d,c,this)},this)},this)};var n={blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(a){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self},o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];j.prototype.clone=function(){return new j(this)},h.call(j.prototype),h.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},m.error=function(){var a=new m(null,{status:0,statusText:""});return a.type="error",a};var p=[301,302,303,307,308];m.redirect=function(a,b){if(-1===p.indexOf(b))throw new RangeError("Invalid status code");return new m(null,{status:b,headers:{location:a}})},self.Headers=c,self.Request=j,self.Response=m,self.fetch=function(a,b){return new Promise(function(c,d){function e(){return"responseURL"in g?g.responseURL:/^X-Request-URL:/m.test(g.getAllResponseHeaders())?g.getResponseHeader("X-Request-URL"):void 0}var f;f=j.prototype.isPrototypeOf(a)&&!b?a:new j(a,b);var g=new XMLHttpRequest;g.onload=function(){var a=1223===g.status?204:g.status;if(100>a||a>599)return void d(new TypeError("Network request failed"));var b={status:a,statusText:g.statusText,headers:l(g),url:e()},f="response"in g?g.response:g.responseText;c(new m(f,b))},g.onerror=function(){d(new TypeError("Network request failed"))},g.open(f.method,f.url,!0),"include"===f.credentials&&(g.withCredentials=!0),"responseType"in g&&n.blob&&(g.responseType="blob"),f.headers.forEach(function(a,b){g.setRequestHeader(b,a)}),g.send("undefined"==typeof f._bodyInit?null:f._bodyInit)})},self.fetch.polyfill=!0}}();var m=[],n={},o="\n\nprecision mediump float;\n\nuniform mat4 u_transform;\n\nattribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\n\nvarying vec2 v_texCoord;\nvarying vec4 v_color;\n\nvoid main() {\n	gl_Position = u_transform * a_position;\n	v_texCoord = a_texCoord;\n	v_color = a_color;\n}\n\n",p="\n\nprecision mediump float;\n\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying vec4 v_color;\n\nvoid main() {\n	gl_FragColor = texture2D(u_texture, v_texCoord);\n}\n\n";k.prototype.draw=function(a,c,d){(this.texture!=a.texture||this.batchIndex==this.BATCH_SIZE)&&this.flush(),d||(d={r:1,g:1,b:1,a:1}),this.texture=a.texture;for(var e=4*this.batchIndex*this.VERTEX_SIZE,f=a.frame,g=[[-.5,-.5],[.5,-.5],[-.5,.5],[.5,.5]],h=[[f.x,f.y],[f.x+f.width,f.y],[f.x,f.y+f.height],[f.x+f.width,f.y+f.height]],i=0;4>i;i++){var j=h[i],k=b(c,g[i]);this.vertexData[e+0]=k[0],this.vertexData[e+1]=k[1],this.vertexData[e+2]=j[0],this.vertexData[e+3]=j[1],this.vertexData[e+4]=d.r,this.vertexData[e+5]=d.g,this.vertexData[e+6]=d.b,this.vertexData[e+7]=d.a,e+=this.VERTEX_SIZE}this.batchIndex+=1},k.prototype.flush=function(){if(this.batchIndex>0){var a=this.batchIndex*this.VERTEX_SIZE*4,b=this.vertexData.subarray(0,a);r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,b,r.STREAM_DRAW),r.useProgram(this.program),r.enableVertexAttribArray(0),r.enableVertexAttribArray(1),r.enableVertexAttribArray(2),r.activeTexture(r.TEXTURE0+0),r.bindTexture(r.TEXTURE_2D,this.texture.texture),r.uniformMatrix4fv(this.uTransform,!1,this.transform),r.uniform1i(this.uTexture,0);var c=4*this.VERTEX_SIZE;r.vertexAttribPointer(this.aPosition,2,r.FLOAT,r.FALSE,c,0),r.vertexAttribPointer(this.aTexCoord,2,r.FLOAT,r.FALSE,c,8),r.vertexAttribPointer(this.aColor,4,r.FLOAT,r.FALSE,c,16);var d=6*this.batchIndex;r.drawElements(r.TRIANGLES,d,r.UNSIGNED_SHORT,0)}this.batchIndex=0,this.texture=null};var q=document.getElementById("game_canvas"),r=h(q),s=new k,t=0;g("data/atlas").then(function(){window.requestAnimationFrame(l)})}();